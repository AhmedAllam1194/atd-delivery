<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>الأسطول | AllamTechno</title>
<link rel="icon" href="assets/favicon.ico">
<link rel="stylesheet" href="app.css">
<script src="config.js"></script>
<script src="dev.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  if(!firebase.apps.length) firebase.initializeApp(window.AT_FIREBASE_CONFIG);
  const db = firebase.firestore();
  firebase.auth().onAuthStateChanged(function(u){ if(!u){ location.href='login.html'; } });
</script>


<script>
(function(){
  const url = new URL(location.href);
  if (url.searchParams.get('dev') === '1'){ localStorage.setItem('AT_DEV_ENABLED','1'); }
  document.addEventListener('DOMContentLoaded', function(){
    if (window.__AT_DEV__) window.__AT_DEV__.applyDevVisibility();
  });
})();
</script>

</head>
<body>
<div class="topbar">
  <div><b>AllamTechno Delivery</b></div>
  <div><button class="dev-only dev-icon" title="إعدادات المطور" onclick="__AT_DEV__.openDevModal()">⚙️</button> <button class="button" onclick="firebase.auth().signOut()">خروج</button></div>
</div>
<div class="layout">
  <aside class="sidebar">
    <nav class="menu">
      <a href="dashboard.html" class="">🏠 الرئيسية</a>
      <a href="orders.html" class="">📦 الطلبات</a>
      <a href="drivers.html" class="">🚗 السائقون</a>
      <a href="companies.html" class="">🏢 الشركات</a>
      <a href="accounts.html" class="">💰 الحسابات</a>
      <a href="fleet.html" class="active">🚙 الأسطول</a>
      <a href="reports.html" class="">📈 التقارير</a>
      <a href="settings.html" class="">⚙️ الإعدادات</a>
    </nav>
  </aside>
  <main class="content">
    
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h3 style="margin:0">مركبات الأسطول</h3>
    <button class="button" onclick="addV()">➕ إضافة</button>
  </div>
  <table class="table" id="tbl"><thead><tr><th>ID</th><th>النوع</th><th>لوحة</th><th>عداد</th><th>تأمين</th><th>رخصة</th><th></th></tr></thead><tbody></tbody></table>
</div>
<script>
var c = db.collection('fleet');
async function load(){
  var s = await c.get(); var tb=document.querySelector('#tbl tbody'); tb.innerHTML='';
  s.forEach(function(d){ var v=d.data(); var tr=document.createElement('tr');
    tr.innerHTML='<td>'+d.id+'</td><td>'+(v.type||'')+'</td><td>'+(v.plate||'')+'</td><td>'+(v.odo||'')+'</td><td>'+(v.insurance||'')+'</td><td>'+(v.license||'')+'</td>' +
    '<td><button onclick="editV(\''+d.id+'\')">تعديل</button> <button onclick="delV(\''+d.id+'\')">حذف</button></td>'; tb.appendChild(tr);
  });
}
async function addV(){ var id=prompt('ID (CAR-01/BIK-01)'); if(!id) return; var data={type:prompt('نوع:','سيارة'),plate:prompt('لوحة:'),odo:parseInt(prompt('عداد:','0')||'0',10),insurance:prompt('تأمين:',''),license:prompt('رخصة:','')}; await c.doc(id).set(data); load(); }
async function editV(id){ var d=await c.doc(id).get(); if(!d.exists) return; var v=d.data(); var data={type:prompt('نوع:',v.type)||v.type,plate:prompt('لوحة:',v.plate)||v.plate,odo:parseInt(prompt('عداد:',v.odo||'0')||v.odo||'0',10),insurance:prompt('تأمين:',v.insurance)||v.insurance,license:prompt('رخصة:',v.license)||v.license}; await c.doc(id).set(data); load(); }
async function delV(id){ if(confirm('حذف؟')){ await c.doc(id).delete(); load(); } }
load();
</script>

  </main>
</div>
</body></html>