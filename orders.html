<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø§Ù„Ø·Ù„Ø¨Ø§Øª | AllamTechno</title>
<link rel="icon" href="assets/favicon.ico">
<link rel="stylesheet" href="app.css">
<script src="config.js"></script>
<script src="dev.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  if(!firebase.apps.length) firebase.initializeApp(window.AT_FIREBASE_CONFIG);
  const db = firebase.firestore();
  firebase.auth().onAuthStateChanged(function(u){ if(!u){ location.href='login.html'; } });
</script>


<script>
(function(){
  const url = new URL(location.href);
  if (url.searchParams.get('dev') === '1'){ localStorage.setItem('AT_DEV_ENABLED','1'); }
  document.addEventListener('DOMContentLoaded', function(){
    if (window.__AT_DEV__) window.__AT_DEV__.applyDevVisibility();
  });
})();
</script>

</head>
<body>
<div class="topbar">
  <div><b>AllamTechno Delivery</b></div>
  <div><button class="dev-only dev-icon" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±" onclick="__AT_DEV__.openDevModal()">âš™ï¸</button> <button class="button" onclick="firebase.auth().signOut()">Ø®Ø±ÙˆØ¬</button></div>
</div>
<div class="layout">
  <aside class="sidebar">
    <nav class="menu">
      <a href="dashboard.html" class="">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="orders.html" class="active">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
      <a href="drivers.html" class="">ğŸš— Ø§Ù„Ø³Ø§Ø¦Ù‚ÙˆÙ†</a>
      <a href="companies.html" class="">ğŸ¢ Ø§Ù„Ø´Ø±ÙƒØ§Øª</a>
      <a href="accounts.html" class="">ğŸ’° Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</a>
      <a href="fleet.html" class="">ğŸš™ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„</a>
      <a href="reports.html" class="">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
      <a href="settings.html" class="">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
    </nav>
  </aside>
  <main class="content">
    
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h3 style="margin:0">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
    <button class="button" onclick="addOrder()">â• Ø¥Ø¶Ø§ÙØ©</button>
  </div>
  <table class="table" id="tbl"><thead><tr><th>Ø±Ù‚Ù…</th><th>ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ø³Ø§Ø¦Ù‚</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th></th></tr></thead><tbody></tbody></table>
</div>
<script>
var c = db.collection('orders');
async function load(){
  var s = await c.orderBy('date','desc').limit(50).get();
  var tb = document.querySelector('#tbl tbody'); tb.innerHTML='';
  s.forEach(function(d){
    var o=d.data();
    var tr=document.createElement('tr');
    tr.innerHTML = '<td>'+d.id+'</td><td>'+(o.date||'')+'</td><td>'+(o.client||'')+'</td><td>'+(o.driver||'')+'</td><td>'+(o.status||'')+'</td><td>'+(o.amount||0)+'</td>' +
    '<td><button onclick="editOrder(\''+d.id+'\')">ØªØ¹Ø¯ÙŠÙ„</button> <button onclick="delOrder(\''+d.id+'\')">Ø­Ø°Ù</button> <button onclick="assign(\''+d.id+'\')">ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø¦Ù‚</button></td>';
    tb.appendChild(tr);
  });
}
async function addOrder(){
  var id = prompt('Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ØŸ (ORD-1001)'); if(!id) return;
  var data={date:prompt('ØªØ§Ø±ÙŠØ® (YYYY-MM-DD):'),client:prompt('Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:'),driver:'',status:'Ø¬Ø¯ÙŠØ¯',amount:parseFloat(prompt('Ø§Ù„Ù…Ø¨Ù„Øº:','0')||'0')};
  await c.doc(id).set(data); load();
}
async function editOrder(id){
  var d=await c.doc(id).get(); if(!d.exists) return;
  var o=d.data();
  var data={date:prompt('ØªØ§Ø±ÙŠØ®:',o.date)||o.date,client:prompt('Ø¹Ù…ÙŠÙ„:',o.client)||o.client,driver:prompt('Ø³Ø§Ø¦Ù‚:',o.driver)||o.driver,status:prompt('Ø­Ø§Ù„Ø©:',o.status)||o.status,amount:parseFloat(prompt('Ù…Ø¨Ù„Øº:',o.amount||'0')||o.amount||'0')};
  await c.doc(id).set(data); load();
}
async function delOrder(id){ if(confirm('Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ')){ await c.doc(id).delete(); load(); } }
async function assign(id){
  var d=await c.doc(id).get(); if(!d.exists) return;
  var o=d.data(); var drv=prompt('Ø§Ø®ØªÙØ±/Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚:', o.driver||''); if(drv===null) return;
  await c.doc(id).set(Object.assign(o, { driver: drv, status: o.status==='Ø¬Ø¯ÙŠØ¯'?'Ø¬Ø§Ø±ÙŠ':o.status })); load();
}
load();
</script>

  </main>
</div>
</body></html>